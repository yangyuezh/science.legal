<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Altmetric Access | science.legal</title>
    <meta name="description" content="Altmetric access and integration status for science.legal." />
    <link rel="canonical" href="https://science.legal/altmetric.html" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="hero">
      <section class="hero-content">
        <p class="kicker">science.legal</p>
        <h1>Altmetric</h1>
        <div id="status" class="panel">Loading status...</div>
        <p>
          <a class="btn primary" href="/auth/altmetric/login">Open Altmetric login</a>
          <a class="btn ghost" href="/auth/altmetric/logout?next=/altmetric.html">Reset status</a>
          <a class="btn ghost" href="/">Back to Declaration</a>
        </p>
        <p class="subtitle">
          Current implementation uses portal-mode authorization. On-site verified identity requires official OAuth/SSO app credentials from Altmetric.
        </p>
      </section>
    </main>

    <script>
      (async function () {
        const statusEl = document.getElementById("status");
        try {
          const res = await fetch("/api/altmetric/me", { credentials: "include" });
          const data = await res.json();

          if (data.portal_opened) {
            statusEl.innerHTML =
              "<h2>Portal opened</h2><p>Altmetric Explorer login portal was opened.</p>" +
              "<p>On-site verified identity is not yet enabled for this provider.</p>";
            return;
          }

          if (data.api_configured) {
            statusEl.innerHTML =
              "<h2>API credentials detected</h2><p>Altmetric API credentials are configured.</p>" +
              "<p>Identity verification remains portal-mode unless provider OAuth details are available.</p>";
            return;
          }

          statusEl.innerHTML =
            "<h2>Not connected</h2><p>No Altmetric portal session marker detected yet.</p>";
        } catch {
          statusEl.innerHTML = "<h2>Error</h2><p>Unable to load Altmetric status.</p>";
        }
      })();
    </script>
  </body>
</html>
